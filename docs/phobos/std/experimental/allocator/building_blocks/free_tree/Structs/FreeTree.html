<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Struct - FreeTree | Marmos Demo </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Struct - FreeTree | Marmos Demo ">
      
      
      <link rel="icon" href="../../../../../../../favicon.ico">
      <link rel="stylesheet" href="../../../../../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../../../../../public/main.css">
      <meta name="docfx:navrel" content="../../../../../../../toc.html">
      <meta name="docfx:tocrel" content="../../../../../toc.html">
      
      <meta name="docfx:rel" content="../../../../../../../">
      
      
      
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../../../../../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="ApiPage">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../../../../../index.html">
            <img id="logo" class="svg" src="../../../../../../../logo.svg" alt="Marmos Demo">
            Marmos Demo
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="std.experimental.allocator.building_blocks.free_tree.Structs.FreeTree">
<h1 class='section'>Struct - FreeTree</h1><div class="facts text-secondary">
<dl><dt>Module</dt><dd>std.experimental.allocator.building_blocks.free_tree</dd></dl>
</div><pre><code class='lang-d'>struct FreeTree( ParentAllocator )
{
  // Allocates `n` bytes of memory. First consults the free tree, and returns from it if a suitably sized block is found. Otherwise, the parent allocator is tried. If allocation from the parent succeeds, the allocated block is returned. Otherwise, the free tree tries an alternate strategy: If $(D ParentAllocator) defines `deallocate` , `FreeTree` releases all of its contents and tries again. 
  void[] allocate( size_t n ) 
  // 
  void assertValid() 
  // Defined if `ParentAllocator.deallocate` exists, and returns to it all memory held in the free tree. 
  void clear() 
  // Places `b` into the free tree. 
  bool deallocate( void[] b ) 
  // Defined if `ParentAllocator.deallocateAll` exists, and forwards to it. Also nullifies the free tree (it&#39;s assumed the parent frees all memory stil managed by the free tree). 
  bool deallocateAll() 
  // 
  void dump() 
  // 
  void[] findAndRemove( ref Node* n, size_t s ) 
  // 
  string formatSizes() 
  // Returns $(D parent.goodAllocSize(max(Node.sizeof, s))). 
  size_t goodAllocSize( size_t s ) 
  // 
  void insertAsRoot( Node* which ) 
  // 
  void[] remove( ref Node* which ) 
  // 
  static void rotate( ref Node* parent, bool toRight ) 

  // The `FreeTree` is word aligned. 
  uint alignment = size_t.alignof
  // 
  ParentAllocator parent
  // 
  Node* root
}</code></pre><h2 class='section'>About</h2><p>The Free Tree allocator, stackable on top of any other allocator, bears similarity with the free list allocator. Instead of a singly-linked list of previously freed blocks, it maintains a binary search tree. This allows the Free Tree allocator to manage blocks of arbitrary lengths and search them efficiently.</p>
<h3 class='section'>Common uses of `FreeTree` include</h3><p>$(UL $(LI Adding <code>deallocate</code> capability to an allocator that lacks it (such as simple regions).) $(LI Getting the benefits of multiple adaptable freelists that do not need to be tuned for one specific size but insted automatically adapts itself to frequently used sizes.) )</p>
<p>The free tree has special handling of duplicates (a singly-linked list per node) in anticipation of large number of duplicates. Allocation time from the free tree is expected to be $(BIGOH log n) where <code>n</code> is the number of distinct sizes (not total nodes) kept in the free tree.</p>
<p>Allocation requests first search the tree for a buffer of suitable size deallocated in the past. If a match is found, the node is removed from the tree and the memory is returned. Otherwise, the allocation is directed to $(D ParentAllocator). If at this point <code>ParentAllocator</code> also fails to allocate, <code>FreeTree</code> frees everything and then tries the parent allocator again.</p>
<p>Upon deallocation, the deallocated block is inserted in the internally maintained free tree (not returned to the parent). The free tree is not kept balanced. Instead, it has a last-in-first-out flavor because newly inserted blocks are rotated to the root of the tree. That way allocations are cache friendly and also frequently used sizes are more likely to be found quickly, whereas seldom used sizes migrate to the leaves of the tree.</p>
<p><code>FreeTree</code> rounds up small allocations to at least $(D 4 size_t.sizeof), which on 64-bit system is one cache line size. If very small objects need to be efficiently allocated, the <code>FreeTree</code> should be fronted with an appropriate small object allocator.</p>
<p>The following methods are defined if <code>ParentAllocator</code> defines them, and forward to it: <code>allocateAll</code> , <code>expand</code> , <code>owns</code> , <code>reallocate</code> .</p>
<h2 class='section'>Functions</h2><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="../FreeTree/FreeTree/Functions/allocate.html">allocate</a></td>
<td>Allocates <code>n</code> bytes of memory. First consults the free tree, and returns from it if a suitably sized block is found. Otherwise, the parent allocator is tried. If allocation from the parent succeeds, the allocated block is returned. Otherwise, the free tree tries an alternate strategy: If $(D ParentAllocator) defines <code>deallocate</code> , <code>FreeTree</code> releases all of its contents and tries again.</td>
</tr>
<tr>
<td><a href="../FreeTree/FreeTree/Functions/assertValid.html">assertValid</a></td>
<td></td>
</tr>
<tr>
<td><a href="../FreeTree/FreeTree/Functions/clear.html">clear</a></td>
<td>Defined if <code>ParentAllocator.deallocate</code> exists, and returns to it all memory held in the free tree.</td>
</tr>
<tr>
<td><a href="../FreeTree/FreeTree/Functions/deallocate.html">deallocate</a></td>
<td>Places <code>b</code> into the free tree.</td>
</tr>
<tr>
<td><a href="../FreeTree/FreeTree/Functions/deallocateAll.html">deallocateAll</a></td>
<td>Defined if <code>ParentAllocator.deallocateAll</code> exists, and forwards to it. Also nullifies the free tree (it's assumed the parent frees all memory stil managed by the free tree).</td>
</tr>
<tr>
<td><a href="../FreeTree/FreeTree/Functions/dump.html">dump</a></td>
<td></td>
</tr>
<tr>
<td><a href="../FreeTree/FreeTree/Functions/findAndRemove.html">findAndRemove</a></td>
<td></td>
</tr>
<tr>
<td><a href="../FreeTree/FreeTree/Functions/formatSizes.html">formatSizes</a></td>
<td></td>
</tr>
<tr>
<td><a href="../FreeTree/FreeTree/Functions/goodAllocSize.html">goodAllocSize</a></td>
<td>Returns $(D parent.goodAllocSize(max(Node.sizeof, s))).</td>
</tr>
<tr>
<td><a href="../FreeTree/FreeTree/Functions/insertAsRoot.html">insertAsRoot</a></td>
<td></td>
</tr>
<tr>
<td><a href="../FreeTree/FreeTree/Functions/remove.html">remove</a></td>
<td></td>
</tr>
<tr>
<td><a href="../FreeTree/FreeTree/Functions/rotate.html">rotate</a></td>
<td></td>
</tr>
</tbody>
</table>
<h2 class='section'>Structs</h2><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="../FreeTree/FreeTree/Structs/Node.html">Node</a></td>
<td></td>
</tr>
</tbody>
</table>
<h2 class='section'>Variables</h2><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="../FreeTree/FreeTree/Variables/alignment.html">alignment</a></td>
<td>The <code>FreeTree</code> is word aligned.</td>
</tr>
<tr>
<td><a href="../FreeTree/FreeTree/Variables/parent.html">parent</a></td>
<td></td>
</tr>
<tr>
<td><a href="../FreeTree/FreeTree/Variables/root.html">root</a></td>
<td></td>
</tr>
</tbody>
</table>

</article>

        <div class="contribution d-print-none">
        </div>


      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
