<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Struct - Quantizer | Marmos Demo </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Struct - Quantizer | Marmos Demo ">
      
      
      <link rel="icon" href="../../../../../../../favicon.ico">
      <link rel="stylesheet" href="../../../../../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../../../../../public/main.css">
      <meta name="docfx:navrel" content="../../../../../../../toc.html">
      <meta name="docfx:tocrel" content="../../../../../toc.html">
      
      <meta name="docfx:rel" content="../../../../../../../">
      
      
      
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../../../../../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="ApiPage">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../../../../../index.html">
            <img id="logo" class="svg" src="../../../../../../../logo.svg" alt="Marmos Demo">
            Marmos Demo
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="std.experimental.allocator.building_blocks.quantizer.Structs.Quantizer">
<h1 class='section'>Struct - Quantizer</h1><div class="facts text-secondary">
<dl><dt>Module</dt><dd>std.experimental.allocator.building_blocks.quantizer</dd></dl>
</div><pre><code class='lang-d'>struct Quantizer( ParentAllocator, alias roundingFunction )
{
  // Defined only if `parent.alignedAllocate` exists and works similarly to `allocate` by forwarding to $(D parent.alignedAllocate(goodAllocSize(n), a)). 
  void[] alignedAllocate( size_t n, uint a ) 
  // Defined only if `ParentAllocator.alignedAllocate` exists. Expansion occurs in place under the conditions required by `expand` . Shrinking occurs in place if $(D goodAllocSize(b.length) == goodAllocSize(s)). 
  bool alignedReallocate( ref void[] b, size_t s, uint a ) 
  // Gets a larger buffer `buf` by calling `parent.allocate(goodAllocSize(n))` . If `buf` is `null` , returns `null` . Otherwise, returns $(D buf[0 .. n]). 
  void[] allocate( size_t n ) 
  // 
  void[] allocateZeroed( )( size_t n ) 
  // Defined if `ParentAllocator.deallocate` exists and forwards to $(D parent.deallocate(b.ptr[0 .. goodAllocSize(b.length)])). 
  bool deallocate( void[] b ) 
  // First checks whether there&#39;s enough slack memory preallocated for `b` by evaluating $(D b.length + delta &lt;= goodAllocSize(b.length)). If that&#39;s the case, expands `b` in place. Otherwise, attempts to use `parent.expand` appropriately if present. 
  bool expand( ref void[] b, size_t delta ) 
  // Returns `roundingFunction(n)` . 
  size_t goodAllocSize( size_t n ) 
  // Expands or shrinks allocated block to an allocated size of $(D goodAllocSize(s)). Expansion occurs in place under the conditions required by `expand` . Shrinking occurs in place if $(D goodAllocSize(b.length) == goodAllocSize(s)). 
  bool reallocate( ref void[] b, size_t s ) 

  // Alignment is identical to that of the parent. 
  &lt;enum or auto&gt; alignment = ParentAllocator.alignment
  // The parent allocator. Depending on whether `ParentAllocator` holds state or not, this is a member variable or an alias for `ParentAllocator.instance` . 
  ParentAllocator parent
}</code></pre><h2 class='section'>About</h2><p>This allocator sits on top of <code>ParentAllocator</code> and quantizes allocation sizes, usually from arbitrary positive numbers to a small set of round numbers (e.g. powers of two, page sizes etc). This technique is commonly used to:</p>
<p>$(UL $(LI Preallocate more memory than requested such that later on, when reallocation is needed (e.g. to grow an array), expansion can be done quickly in place. Reallocation to smaller sizes is also fast (in-place) when the new size requested is within the same quantum as the existing size. Code that's reallocation-heavy can therefore benefit from fronting a generic allocator with a <code>Quantizer</code> . These advantages are present even if <code>ParentAllocator</code> does not support reallocation at all.) $(LI Improve behavior of allocators sensitive to allocation sizes, such as <code>FreeList</code> and <code>FreeTree</code> . Rounding allocation requests up makes for smaller free lists/trees at the cost of slack memory (internal fragmentation).) )</p>
<h3 class='section'>The following methods are forwarded to the parent allocator if present</h3><p><code>allocateAll</code> , <code>owns</code> , <code>deallocateAll</code> , <code>empty</code> .</p>
<p>Preconditions: <code>roundingFunction</code> must satisfy three constraints. These are not enforced (save for the use of <code>assert</code> ) for the sake of efficiency. $(OL $(LI $(D roundingFunction(n) &gt;= n) for all <code>n</code> of type <code>size_t</code> ;) $(LI <code>roundingFunction</code> must be monotonically increasing, i.e. $(D roundingFunction(n1) &lt;= roundingFunction(n2)) for all $(D n1 &lt; n2);) $(LI <code>roundingFunction</code> must be <code>nothrow</code> , <code>@safe</code> , <code>@nogc</code> and <code>pure</code> , i.e. always return the same value for a given <code>n</code> .) )</p>
<h2 class='section'>Functions</h2><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="../Quantizer/Quantizer/Functions/alignedAllocate.html">alignedAllocate</a></td>
<td>Defined only if <code>parent.alignedAllocate</code> exists and works similarly to <code>allocate</code> by forwarding to $(D parent.alignedAllocate(goodAllocSize(n), a)).</td>
</tr>
<tr>
<td><a href="../Quantizer/Quantizer/Functions/alignedReallocate.html">alignedReallocate</a></td>
<td>Defined only if <code>ParentAllocator.alignedAllocate</code> exists. Expansion occurs in place under the conditions required by <code>expand</code> . Shrinking occurs in place if $(D goodAllocSize(b.length) == goodAllocSize(s)).</td>
</tr>
<tr>
<td><a href="../Quantizer/Quantizer/Functions/allocate.html">allocate</a></td>
<td>Gets a larger buffer <code>buf</code> by calling <code>parent.allocate(goodAllocSize(n))</code> . If <code>buf</code> is <code>null</code> , returns <code>null</code> . Otherwise, returns $(D buf[0 .. n]).</td>
</tr>
<tr>
<td><a href="../Quantizer/Quantizer/Functions/allocateZeroed.html">allocateZeroed</a></td>
<td></td>
</tr>
<tr>
<td><a href="../Quantizer/Quantizer/Functions/deallocate.html">deallocate</a></td>
<td>Defined if <code>ParentAllocator.deallocate</code> exists and forwards to $(D parent.deallocate(b.ptr[0 .. goodAllocSize(b.length)])).</td>
</tr>
<tr>
<td><a href="../Quantizer/Quantizer/Functions/expand.html">expand</a></td>
<td>First checks whether there's enough slack memory preallocated for <code>b</code> by evaluating $(D b.length + delta &lt;= goodAllocSize(b.length)). If that's the case, expands <code>b</code> in place. Otherwise, attempts to use <code>parent.expand</code> appropriately if present.</td>
</tr>
<tr>
<td><a href="../Quantizer/Quantizer/Functions/goodAllocSize.html">goodAllocSize</a></td>
<td>Returns <code>roundingFunction(n)</code> .</td>
</tr>
<tr>
<td><a href="../Quantizer/Quantizer/Functions/reallocate.html">reallocate</a></td>
<td>Expands or shrinks allocated block to an allocated size of $(D goodAllocSize(s)). Expansion occurs in place under the conditions required by <code>expand</code> . Shrinking occurs in place if $(D goodAllocSize(b.length) == goodAllocSize(s)).</td>
</tr>
</tbody>
</table>
<h2 class='section'>Variables</h2><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="../Quantizer/Quantizer/Variables/alignment.html">alignment</a></td>
<td>Alignment is identical to that of the parent.</td>
</tr>
<tr>
<td><a href="../Quantizer/Quantizer/Variables/parent.html">parent</a></td>
<td>The parent allocator. Depending on whether <code>ParentAllocator</code> holds state or not, this is a member variable or an alias for <code>ParentAllocator.instance</code> .</td>
</tr>
</tbody>
</table>

</article>

        <div class="contribution d-print-none">
        </div>


      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
