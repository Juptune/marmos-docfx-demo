<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Struct - String2 | Marmos Demo </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Struct - String2 | Marmos Demo ">
      
      
      <link rel="icon" href="../../../../../../favicon.ico">
      <link rel="stylesheet" href="../../../../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../../../../public/main.css">
      <meta name="docfx:navrel" content="../../../../../../toc.html">
      <meta name="docfx:tocrel" content="../../../../toc.html">
      
      <meta name="docfx:rel" content="../../../../../../">
      
      
      
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../../../../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="ApiPage">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../../../../index.html">
            <img id="logo" class="svg" src="../../../../../../logo.svg" alt="Marmos Demo">
            Marmos Demo
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="juptune.core.ds.string2.Structs.String2">
<h1 class='section'>Struct - String2</h1><div class="facts text-secondary">
<dl><dt>Module</dt><dd>juptune.core.ds.string2</dd></dl>
</div><pre><code class='lang-d'>public struct String2
{
  // 
  alias opDollar = &lt;todo: marmos support pending&gt;

  // A safer-ish way to access the underlying slice, by forcing it to go through a scoped delegate. 
  auto access( RetT )( scope RetT delegate(scope char[]) @safe accessor ) @trusted
  // ditto. 
  auto access(
    RetT
  )(
    scope RetT delegate(scope char[]) @nogc @safe nothrow accessor
  ) @nogc @trusted nothrow
  // A named constructor for `String2` that will convert the given char-based `Array` into a string, and then destroy the array, effectively &quot;moving&quot; the array into a string. 
  String2 fromDestroyingArray( ArrayT )( ref scope ArrayT arr ) 
  // 
  bool isBig() @safe
  // The length of the string. 
  size_t length() @safe
  // 
  void markBig() @safe
  // 
  void moveToBigString() @trusted
  // Simple assignment operator that forwards to the appropriate ctor. 
  void opAssign( CtorParam )( scope CtorParam param ) @trusted
  // Concatenation operator. 
  String2 opBinary( string op )( scope char[] rhs ) @trusted
  // Concatenation operator. 
  String2 opBinary( string op )( const scope String2 rhs ) @trusted
  // Concatenation operator. 
  String2 opBinary( string op )( const ref scope String2 rhs ) @trusted
  // Basic equality operator for common string types, including `char[]` , and `String2` . 
  bool opEquals( scope char[] rhs ) @trusted
  // ditto. 
  bool opEquals( const scope String2 rhs ) @trusted
  // ditto. 
  bool opEquals( const ref scope String2 rhs ) @trusted
  // 
  String2 opIndex( const OpSlice slice ) @trusted
  // Simple [] operator to access the character at the given index. 
  char opIndex( const size_t index ) @trusted
  // Concatenation assignment operator. 
  void opOpAssign( string op )( scope char[] rhs ) @trusted
  // Concatenation assignment operator. 
  void opOpAssign( string op )( const scope String2 rhs ) @trusted
  // Concatenation assignment operator. 
  void opOpAssign( string op )( const ref scope String2 rhs ) @trusted
  // 
  OpSlice opSlice( size_t start, size_t end ) @safe
  // Provides an input range over the string&#39;s characters. 
  auto range() @trusted
  // 
  void setupBigString( scope char[] str ) @trusted
  // 
  void setupSmallString( scope char[] str ) @trusted
  // Provides access to the raw slice of the string, which will always be on the heap. 
  ref char[] slice() scope return
  // Provides access to the raw slice of the string, which may be on the stack or heap, depending on if Small String Optimisation is in use. 
  ref char[] sliceMaybeFromStack() scope return
  // Hashes the contents of the string using MurmurHash3. 
  uint toHash() @trusted

  // 
  &lt;enum or auto&gt; SSO_OVERHEAD_BYTES = 1
}</code></pre><h2 class='section'>About</h2><p>An immutable string implemenetation with small string optimization, focused on making it safe and efficient to pass around a string by value by trading off the ability to mutate the string.</p>
<p>This struct is not** thread safe.</p>
<h3 class='section'>Design</h3><p>This struct will apply small string optimization (SSO) to store small strings in the struct itself, and will allocate memory for larger strings (or under specific conditions).</p>
<p>The SSO length will be ((void*).sizeof 3) - 1, which is 23 bytes on x86_64 for example.</p>
<p>This struct contains a ref counted payload, which is shared amongst copies of this struct. This is to make it very easy to pass the struct around without worrying about allocations.</p>
<p>This struct will never expose a mutable slice to the underlying memory, as it is assumed thet the string has already been fully constructed.</p>
<p>While this struct does provide a concat operation, it will always create a copy of the string, and thus is very inefficient for large strings. This is by design, use <code>Array!char</code> instead.</p>
<p>To help avoid the need to provide direct access to the underlying slice (and risking escape), this struct attempts to provide enough operator overloads to make it easy to work with, for things like &quot;String2 == char[]&quot; operations.</p>
<p>Additionally there are 3 different ways to access the underlying slice, depending on use case and safety concerns: (<code>String2.slice</code>, <code>String2.sliceMaybeFromStack</code> , <code>String2.access</code> ), as well as a safer but more limited way via the <code>String2.range</code> function.</p>
<p>In the rare instances you need to pass the slice to a native C function, please note that the underlying memory is null terminated (but not subslices of the payload).</p>
<h3 class='section'>Performance</h3><p>Not yet measured to any reasonable degree, however logically it should be much more efficient than the previous implementation which would do a full copy on every struct copy, and had gaping memory safety holes.</p>
<h3 class='section'>Safety</h3><p>The assumption is that any operation self contained within the struct's code is @safe, and any operation that requires the underlying slice to be exposed is to be explicitly marked as @trusted by the caller.</p>
<p>This struct is only safe to move as long as there's no living slices to the string's SSO buffer.</p>
<h2 class='section'>Aliases</h2><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="../String2/String2/Aliases/_opCat.html">_opCat</a></td>
<td></td>
</tr>
<tr>
<td><a href="../String2/String2/Aliases/_opCatAssign.html">_opCatAssign</a></td>
<td></td>
</tr>
<tr>
<td><a href="../String2/String2/Aliases/opDollar.html">opDollar</a></td>
<td></td>
</tr>
</tbody>
</table>
<h2 class='section'>Functions</h2><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="../String2/String2/Functions/access.html">access</a></td>
<td>A safer-ish way to access the underlying slice, by forcing it to go through a scoped delegate.</td>
</tr>
<tr>
<td><a href="../String2/String2/Functions/fromDestroyingArray.html">fromDestroyingArray</a></td>
<td>A named constructor for <code>String2</code> that will convert the given char-based <code>Array</code> into a string, and then destroy the array, effectively &quot;moving&quot; the array into a string.</td>
</tr>
<tr>
<td><a href="../String2/String2/Functions/isBig.html">isBig</a></td>
<td></td>
</tr>
<tr>
<td><a href="../String2/String2/Functions/length.html">length</a></td>
<td>The length of the string.</td>
</tr>
<tr>
<td><a href="../String2/String2/Functions/markBig.html">markBig</a></td>
<td></td>
</tr>
<tr>
<td><a href="../String2/String2/Functions/moveToBigString.html">moveToBigString</a></td>
<td></td>
</tr>
<tr>
<td><a href="../String2/String2/Functions/opAssign.html">opAssign</a></td>
<td>Simple assignment operator that forwards to the appropriate ctor.</td>
</tr>
<tr>
<td><a href="../String2/String2/Functions/opBinary.html">opBinary</a></td>
<td>Concatenation operator.</td>
</tr>
<tr>
<td><a href="../String2/String2/Functions/opEquals.html">opEquals</a></td>
<td>Basic equality operator for common string types, including <code>char[]</code> , and <code>String2</code> .</td>
</tr>
<tr>
<td><a href="../String2/String2/Functions/opIndex.html">opIndex</a></td>
<td></td>
</tr>
<tr>
<td><a href="../String2/String2/Functions/opOpAssign.html">opOpAssign</a></td>
<td>Concatenation assignment operator.</td>
</tr>
<tr>
<td><a href="../String2/String2/Functions/opSlice.html">opSlice</a></td>
<td></td>
</tr>
<tr>
<td><a href="../String2/String2/Functions/range.html">range</a></td>
<td>Provides an input range over the string's characters.</td>
</tr>
<tr>
<td><a href="../String2/String2/Functions/setupBigString.html">setupBigString</a></td>
<td></td>
</tr>
<tr>
<td><a href="../String2/String2/Functions/setupSmallString.html">setupSmallString</a></td>
<td></td>
</tr>
<tr>
<td><a href="../String2/String2/Functions/slice.html">slice</a></td>
<td>Provides access to the raw slice of the string, which will always be on the heap.</td>
</tr>
<tr>
<td><a href="../String2/String2/Functions/sliceMaybeFromStack.html">sliceMaybeFromStack</a></td>
<td>Provides access to the raw slice of the string, which may be on the stack or heap, depending on if Small String Optimisation is in use.</td>
</tr>
<tr>
<td><a href="../String2/String2/Functions/toHash.html">toHash</a></td>
<td>Hashes the contents of the string using MurmurHash3.</td>
</tr>
</tbody>
</table>
<h2 class='section'>Structs</h2><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="../String2/String2/Structs/OpSlice.html">OpSlice</a></td>
<td></td>
</tr>
<tr>
<td><a href="../String2/String2/Structs/Payload.html">Payload</a></td>
<td></td>
</tr>
</tbody>
</table>
<h2 class='section'>Variables</h2><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="../String2/String2/Variables/SSO_OVERHEAD_BYTES.html">SSO_OVERHEAD_BYTES</a></td>
<td></td>
</tr>
</tbody>
</table>

</article>

        <div class="contribution d-print-none">
        </div>


      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
